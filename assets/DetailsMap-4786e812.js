import{j as r,l as $t}from"./MapView-858957ce.js";import{af as At,ag as zt,v as Bt,h as K,e as A,q as Et,o as St,ai as _t}from"./index-8c56322a.js";import{c as N}from"./DetailsMapContainer-03cbab68.js";const Wt={id:"details-map"},U=0,w="#333447",V="#514efd",D="lightgrey",T="1.5px",z=1e3,It={__name:"DetailsMap",props:["sizes"],setup(Y){const s=Y,d=At(),n=zt();Bt(()=>{F(),I(),C(),console.log("detailsMapGraph",n.detailsMapGraph)});function F(){const t=r.select("#details-map");o.value=t.style("width").replace("px","")}const Z=$t(()=>{tt()},500);K(()=>d.width,()=>{Z()});function tt(){F(),I(),C()}function I(){r.select("#svg-details-chart").remove(),at(),rt()}function C(){ot(),ut()}const O=A(null),L=A(null),et=Et(()=>{const t=n.detailsMapGraph.children.length;let e=r.max(n.detailsMapGraph.children.map(l=>n.detailsMapGraph.type==="works"?l.data.children.length:l.children.length));e=e||2;const a=n.detailsMapGraph.type==="works"?k:v,u=n.detailsMapGraph.type==="works"?v:k;let i=null;return n.detailsMapGraph.type==="works"?i=t>=e?B+t*a:B+e*u:i=t>e?B+t*a:B+e*u,d.isMobile?B+a*n.detailsMapGraph.children.length+e*u:i}),o=A(null);function at(){O.value=r.select("#details-map").append("svg").attr("id","svg-details-chart").attr("viewBox",`0 0 ${o.value} ${et.value}`),L.value=O.value.append("g").attr("id","details-chart-container").attr("transform",`translate(${U}, ${U})`)}function rt(){nt(),st(),it()}const _=A(null),m=A(null),G=A(null),B=s.sizes.worksBandwidth*5,k=s.sizes.worksBandwidth*3,v=s.sizes.worksBandwidth*1.5,g=s.sizes.worksBandwidth*.5,x=s.sizes.worksBandwidth*.5*2,W=r.easeElasticOut.amplitude(1).period(.4);function lt(){if(d.isMobile){let t=n.detailsMapGraph.children.length;const e=n.detailsMapGraph.type==="works"?k:v,a=n.detailsMapGraph.type==="works"?t*e:t*e+v*1.5;return`translate(0, ${B+a})`}else return`translate(${o.value*.5}, ${B})`}function nt(){_.value=L.value.append("g").attr("transform","translate(0, 0)")}function st(){m.value=L.value.append("g").attr("transform",`translate(0, ${B})`)}function it(){G.value=L.value.append("g").attr("transform",lt())}function ot(){n.detailsMapGraph.type==="works"?dt():n.detailsMapGraph.type==="sdgs"?ct():pt()}function dt(){const t=_.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${s.sizes.worksBandwidth*2})`);t.append("rect").attr("class","title-rect"),t.append("text").attr("class","title").text(n.detailsMapGraph.data.title),t.append("a").attr("xlink:href",n.detailsMapGraph.data.openAlexId).attr("target","_blank").append("rect").attr("class","title-rect-overlay").append("title").text(n.detailsMapGraph.data.title),t.selectAll(".title-rect,.title-rect-overlay").attr("width",o.value).attr("height",s.sizes.worksBandwidth),t.selectAll(".title-rect").attr("stroke",w).attr("fill",w),t.selectAll(".title-rect-overlay").attr("fill-opacity",0).attr("cursor","pointer"),t.selectAll(".title").attr("x",5).attr("y",s.sizes.worksBandwidth*.85).style("font-size",s.sizes.workTitle).attr("fill","white"),_.value.select(".title-group").transition().duration(z).ease(W).attr("transform","translate(0,0)")}function ct(){const a=_.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${s.sizes.worksBandwidth*4})`).append("a").attr("xlink:href",n.detailsMapGraph.data.url).attr("target","_blank").append("g").attr("transform",`translate(${s.sizes.worksBandwidth}, ${s.sizes.worksBandwidth})`);a.append("circle").attr("r",g).attr("stroke",w).attr("fill",w),a.append("text").text(`SDG ${n.detailsMapGraph.data.id}`).attr("x",x).attr("y",0).style("font-size",`${s.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor","start"),a.append("rect").attr("x",x).attr("y",0).attr("fill",n.detailsMapGraph.data.color).attr("opacity",.4).attr("width",n.detailsMapGraph.data.labelBbox.width).attr("height",n.detailsMapGraph.data.labelBbox.height),a.append("text").text(n.detailsMapGraph.data.name).attr("x",x).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",s.sizes.sdgLabel).attr("text-anchor","start"),_.value.select(".title-group").transition().duration(z).ease(W).attr("transform","translate(0,0)")}function pt(){const e=_.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${s.sizes.worksBandwidth*4})`).append("g").attr("transform",`translate(${s.sizes.worksBandwidth}, ${s.sizes.worksBandwidth})`);e.append("circle").attr("r",g).attr("stroke",w).attr("fill",w),e.append("text").text(n.detailsMapGraph.data.name).attr("x",x).attr("y",0).style("font-size",`${s.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","start"),_.value.select(".title-group").transition().duration(z).ease(W).attr("transform","translate(0,0)")}function ut(){n.detailsMapGraph.type==="works"?ht(n.detailsMapGraph.children,ft,P):yt(n.detailsMapGraph.children,vt,Q)}function ht(t,e,a){m.value.selectAll(".first-group-line").data(t).join(u=>u.append("line").attr("class",(i,l)=>["first-group-line",`element-${l}`].join(" ")).attr("stroke",i=>i.data.children.length?D:null).attr("stroke-width",T).attr("x1",x*1.5).attr("y1",(i,l)=>l*k).attr("x2",()=>d.isMobile?o.value*.9:o.value*.4).attr("y2",(i,l)=>l*k)),e(t,wt,gt),a(R,q)}function ft(t,e,a){m.value.selectAll(".first-group-element").data(t).join(u=>u.append("g").attr("class",(i,l)=>["first-group-element",`element-${l}`].join(" ")).attr("transform",`translate(0, -${k*2})`).each(function(i,l){if(i.type==="sdg"){const p=n.homeMapGraph.sdgs.find($=>$.id===i.data.id),h=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("cursor","pointer");h.append("circle").attr("data-id",$=>$.id).attr("cx",g*1.1).attr("cy",0).attr("r",g).attr("stroke",w).attr("fill",w),h.append("text").attr("class","sdg-group-id").attr("x",x*1.5).attr("y",0).text($=>`SDG ${$.data.id}`).style("font-size",`${s.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor","start"),h.append("rect").attr("x",x*1.5).attr("y",0).attr("fill",$=>$.data.color).attr("opacity",.4).attr("width",p.labelBbox.width).attr("height",p.labelBbox.height),h.append("text").text($=>$.data.name).attr("x",x*1.5).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",s.sizes.sdgLabel).attr("text-anchor","start")}else{const p=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("cursor","pointer");p.append("circle").attr("data-id",h=>h.id).attr("cx",g*1.1).attr("cy",0).attr("r",g).attr("stroke",w).attr("fill",w),p.append("text").attr("class","field-group-name").attr("x",x*1.5).attr("y",0).text(h=>h.data.name).style("font-size",`${s.sizes.field}px`).attr("dominant-baseline",()=>i.data.children.length?"text-after-edge":"middle").attr("text-anchor","start")}const c=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("transform",`translate(${d.isMobile?o.value*.9:o.value*.4},0)`).attr("cursor","pointer");i.data.children.length&&(c.append("circle").attr("r",g*1.4).attr("stroke",w).attr("fill",w),c.append("text").text(p=>p.data.children.length).attr("fill","white").style("font-size",`${s.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","middle"))})),m.value.selectAll(".first-group-element").transition().duration(z).ease(W).attr("transform",(u,i)=>`translate(0, ${i*k})`),e(),a()}function f(t){return t==="mouseover"?V:w}function E(t){return t==="mouseover"?V:D}function S(t){return t==="mouseover"?"2.5px":T}function j(t){return t==="mouseover"?"bold":"regular"}function wt(){m.value.selectAll(".group-element").on("mouseover mouseout",function(t){const e=r.select(this).attr("data-index");n.detailsMapGraph.children[e].data.children.length&&r.selectAll(`line.element-${e}`).attr("stroke",E(t.type)).attr("stroke-width",S(t.type)),r.selectAll(`.connection-line-${e}`).attr("stroke",E(t.type)).attr("stroke-width",S(t.type)),e===y.value&&r.selectAll(".shown-work-rect").attr("stroke",f(t.type)).attr("fill",f(t.type)),r.selectAll(`.element-${e} circle`).attr("stroke",f(t.type)).attr("fill",f(t.type)),r.selectAll(`.element-${e} .sdg-group-id`).attr("fill",f(t.type)).attr("font-weight",j(t.type)),r.selectAll(`.element-${e} .field-group-name`).attr("fill",f(t.type)).attr("font-weight",j(t.type))})}const y=A(null),b=A([]),M=A([]);K(()=>y.value,()=>{n.detailsMapGraph.type==="works"?P(R,q):Q(X,J)});function gt(){m.value.selectAll(".group-element").on("click",function(){const t=r.select(this).attr("data-index");if(n.detailsMapGraph.children[t].data.children.length?y.value=t:y.value=null,n.detailsMapGraph.children[t].data.children.length){const e=n.detailsMapGraph.children[t].data.children;b.value=e}else b.value=[]})}function mt(){m.value.selectAll(".group-element").on("click",function(){const t=r.select(this).attr("data-index");if(n.detailsMapGraph.children[t].children.length?y.value=t:y.value=null,n.detailsMapGraph.children[t].children.length){const e=n.detailsMapGraph.children[t].children;M.value=e}else M.value=[]})}function P(t,e){const a=G.value.selectAll(".shown-work").data(b.value,function(c){return c}),u=a.enter().append("g").attr("class","shown-work").attr("transform",`translate(0, -${v*2})`);u.append("rect").attr("class","shown-work-rect").attr("data-id",(c,p)=>p),u.append("text").attr("class","shown-work-title").text(c=>c.title),u.append("rect").attr("class","shown-work-overlay").data(b.value,function(c,p){return p}).each(function(){r.select(this).append("title").text(c=>c.title)});const i=u.merge(a);i.select(".shown-work-title").text(c=>c.title),i.select(".shown-work-overlay title").text(c=>c.title),a.exit().remove(),G.value.selectAll(".shown-work-rect,.shown-work-overlay").attr("width",()=>d.isMobile?o.value*.9:o.value*.5).attr("height",s.sizes.worksBandwidth),G.value.selectAll(".shown-work-rect").attr("stroke",w).attr("fill",w),G.value.selectAll(".shown-work-overlay").attr("class","shown-work-overlay").attr("data-id",(c,p)=>p).attr("fill-opacity",0).attr("cursor","pointer"),G.value.selectAll(".shown-work-title").attr("x",5).attr("y",s.sizes.worksBandwidth*.85).style("font-size",s.sizes.workTitle).attr("fill","white"),G.value.selectAll(".shown-work").transition().duration(z).ease(W).attr("transform",(c,p)=>`translate(0, ${v*p})`),t(),e(xt)}function kt(t){const e=d.isMobile?o.value*.9+g*1.5:o.value*.4+g*1.5,a=t*k,u=d.isMobile?o.value*.96:o.value*.4+g*4,i=d.isMobile?o.value*.96:o.value*.4+g*8,l=d.isMobile?n.detailsMapGraph.children.length*k+(b.value.length-1)*.5*v+s.sizes.worksBandwidth*.5:s.sizes.worksBandwidth*.5,c=d.isMobile?o.value*.92:o.value*.495,p=d.isMobile?n.detailsMapGraph.children.length*k+(b.value.length-1)*.5*v+s.sizes.worksBandwidth*.5:(b.value.length-1)*.5*v+s.sizes.worksBandwidth*.5;return[[{x:e,y:a},{x:u,y:a},{x:i,y:l},{x:c,y:p}]]}function H(t){return r.line().x(a=>a.x).y(a=>a.y).curve(r.curveCatmullRom.alpha(.5))(t)}function R(){const t=y.value?kt(y.value):[];r.selectAll(".connection-line").remove(),m.value.selectAll(".connection-line").data(t).join(e=>e.append("path").attr("class",["connection-line",`connection-line-${y.value}`].join(" ")).attr("d",a=>H(a)).attr("stroke","white").attr("fill","none").attr("stroke-width",T),e=>e,e=>e),m.value.selectAll(".connection-line").transition().duration(z*.3).attr("stroke",D)}function q(t){G.value.selectAll(".shown-work-overlay").on("mouseover mouseout",function(e){const a=y.value,u=r.select(this).attr("data-id");r.select(`.shown-work-rect[data-id='${u}']`).attr("stroke",f(e.type)).attr("fill",f(e.type)),r.selectAll(`line.element-${a}`).attr("stroke",E(e.type)).attr("stroke-width",S(e.type)),r.selectAll(`.connection-line-${a}`).attr("stroke",E(e.type)).attr("stroke-width",S(e.type)),r.selectAll(`.element-${a} circle`).attr("stroke",f(e.type)).attr("fill",f(e.type)),r.selectAll(`.element-${a} .sdg-group-id`).attr("fill",f(e.type)).attr("font-weight",j(e.type)),r.selectAll(`.element-${a} .field-group-name`).attr("fill",f(e.type)).attr("font-weight",j(e.type))}),t()}function xt(){G.value.selectAll(".shown-work-overlay").on("click",async function(){const t=r.select(this).attr("data-id"),e={type:"works",root:b.value[t],sizes:s.sizes},a=await N(e);n.setDetailsMapGraph(a),b.value=[],y.value=null,I(),C()})}function yt(t,e,a){e(t,Gt,mt),m.value.selectAll(".first-group-line").data(t).join(u=>u.append("line").attr("class",(i,l)=>["first-group-line",`element-${l}`].join(" ")).attr("stroke",i=>i.children.length?D:null).attr("stroke-width",T).attr("x1",d.isMobile?o.value*.75:o.value*.45).attr("y1",(i,l)=>l*v+s.sizes.worksBandwidth*.5).attr("x2",d.isMobile?o.value*.9-g*1.5*2:o.value*.5-g*1.5).attr("y2",(i,l)=>l*v+s.sizes.worksBandwidth*.5)),a(X,J)}function vt(t,e,a){m.value.selectAll(".first-group-element").data(t).join(u=>u.append("g").attr("class",(i,l)=>["first-group-element",`element-${l}`].join(" ")).attr("transform",`translate(0, -${v*2})`).each(function(i,l){const c=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l);c.append("rect").attr("class","first-group-work-rect").attr("data-id",l),c.append("text").attr("class","first-group-work-title").attr("data-id",h=>h.id).text(h=>h.title),c.append("rect").attr("class","first-group-work-overlay").each(function(){r.select(this).append("title").text(h=>h.title)});const p=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("transform",`translate(${d.isMobile?o.value*.9-g*1.5:o.value*.5},${s.sizes.worksBandwidth*.5})`).attr("cursor","pointer");i.children.length&&(p.append("circle").attr("class","first-group-work-circle").attr("r",g*1.4).attr("stroke",w).attr("fill",w),p.append("text").text(h=>h.children.length).attr("fill","white").style("font-size",`${s.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","middle"))})),m.value.selectAll(".first-group-work-rect,.first-group-work-overlay").attr("width",()=>d.isMobile?o.value*.75:o.value*.45).attr("height",s.sizes.worksBandwidth),m.value.selectAll(".first-group-work-rect").attr("stroke",w).attr("fill",w),m.value.selectAll(".first-group-work-overlay").attr("fill-opacity",0).attr("cursor","pointer"),m.value.selectAll(".first-group-work-title").attr("x",5).attr("y",s.sizes.worksBandwidth*.85).style("font-size",s.sizes.workTitle).attr("fill","white"),m.value.selectAll(".first-group-element").transition().duration(z).ease(W).attr("transform",(u,i)=>`translate(0, ${v*i})`),e(),a()}function Gt(){m.value.selectAll(".group-element").on("mouseover mouseout",function(t){const e=r.select(this).attr("data-index");n.detailsMapGraph.children[e].children.length&&r.selectAll(`line.element-${e}`).attr("stroke",E(t.type)).attr("stroke-width",S(t.type)),r.selectAll(`.connection-line-${e}`).attr("stroke",E(t.type)).attr("stroke-width",S(t.type)),e===y.value&&(r.selectAll(".shown-element-circle").attr("stroke",f(t.type)).attr("fill",f(t.type)),r.selectAll(".shown-sdg-group-id, .shown-field-group-name").attr("fill",f(t.type)).attr("font-weight",j(t.type))),r.selectAll(`.element-${e} .first-group-work-circle`).attr("stroke",f(t.type)).attr("fill",f(t.type)),r.selectAll(`.element-${e} .first-group-work-rect`).attr("stroke",f(t.type)).attr("fill",f(t.type))})}function Q(t,e){r.selectAll(".shown-element").remove(),G.value.selectAll(".shown-element").data(M.value,function(i){return i}).enter().append("g").attr("class","shown-element").attr("data-id",(i,l)=>l).attr("transform",`translate(${d.isMobile?o.value*.85:o.value*.15}, -${k*2})`).each(function(i,l){if(i.type==="sdg"){const c=n.homeMapGraph.sdgs.find(h=>h.id===i.data.id),p=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("cursor","pointer");p.append("circle").attr("class","shown-element-circle").attr("data-id",h=>h.id).attr("r",g).attr("stroke",w).attr("fill",w),p.append("text").attr("class","shown-sdg-group-id").text(h=>`SDG ${h.data.id}`).attr("x",()=>d.isMobile?-x:x).attr("y",0).style("font-size",`${s.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor",()=>d.isMobile?"end":"start"),p.append("rect").attr("x",d.isMobile?-(c.labelBbox.width+x):x).attr("y",0).attr("fill",h=>h.data.color).attr("opacity",.4).attr("width",c.labelBbox.width).attr("height",c.labelBbox.height),p.append("text").text(h=>h.data.name).attr("x",()=>d.isMobile?-x:x).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",s.sizes.sdgLabel).attr("text-anchor",()=>d.isMobile?"end":"start")}else{const c=r.select(this).append("g").attr("class",["group-element",`element-${l}`].join(" ")).attr("data-index",l).attr("cursor","pointer");c.append("circle").attr("class","shown-element-circle").attr("data-id",p=>p.id).attr("r",g).attr("stroke",w).attr("fill",w),c.append("text").attr("class","shown-field-group-name").text(p=>p.data.name).attr("x",()=>d.isMobile?-x:x).attr("y",0).style("font-size",`${s.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor",()=>d.isMobile?"end":"start")}}),G.value.selectAll(".shown-element").transition().duration(z).ease(W).attr("transform",(i,l)=>`translate(${d.isMobile?o.value*.9-g*1.5:o.value*.15}, ${k*l})`),t(),e(bt)}function Mt(t){const e=d.isMobile?o.value*.9:g*1.5,a=t*v+s.sizes.worksBandwidth*.5,u=d.isMobile?o.value*.95:o.value*.1,i=d.isMobile?o.value*.95:o.value*.1,l=d.isMobile?n.detailsMapGraph.children.length*v+M.value.length*.5*k+k*.25:(M.value.length-1)*.5*k,c=d.isMobile?o.value*.9:o.value*.14,p=d.isMobile?n.detailsMapGraph.children.length*v+M.value.length*.5*k+k*.25:(M.value.length-1)*.5*k;return[[{x:e,y:a},{x:u,y:a},{x:i,y:l},{x:c,y:p}]]}function X(){const t=y.value?Mt(y.value):[],e=d.isMobile?m.value:G.value;r.selectAll(".connection-line").remove(),e.selectAll(".connection-line").data(t).join(a=>a.append("path").attr("class",["connection-line",`connection-line-${y.value}`].join(" ")).attr("d",u=>H(u)).attr("stroke","white").attr("fill","none").attr("stroke-width",T),a=>a,a=>a),e.selectAll(".connection-line").transition().duration(z*.3).attr("stroke",D)}function J(t){G.value.selectAll(".shown-element").on("mouseover mouseout",function(e){const a=y.value;r.select(this).select(".shown-element-circle").attr("stroke",f(e.type)).attr("fill",f(e.type)),r.select(this).select(".shown-sdg-group-id, .shown-field-group-name").attr("fill",f(e.type)).attr("font-weight",j(e.type)),r.selectAll(`line.element-${a}`).attr("stroke",E(e.type)).attr("stroke-width",S(e.type)),r.selectAll(`.connection-line-${a}`).attr("stroke",E(e.type)).attr("stroke-width",S(e.type)),r.selectAll(`.element-${a} .first-group-work-circle`).attr("stroke",f(e.type)).attr("fill",f(e.type)),r.selectAll(`.element-${a} .first-group-work-rect`).attr("stroke",f(e.type)).attr("fill",f(e.type))}),t()}function bt(){G.value.selectAll(".shown-element").on("click",async function(){const t=r.select(this).attr("data-id");let e=M.value[t].data;if(M.value[t].type==="sdg"){const i=n.homeMapGraph.sdgs.find(l=>l.id===e.id);e.labelBbox=i.labelBbox}const a={type:`${M.value[t].type}s`,root:e,sizes:s.sizes},u=await N(a);n.setDetailsMapGraph(u),M.value=[],y.value=null,I(),C()})}return(t,e)=>(St(),_t("div",Wt))}};export{It as default};
