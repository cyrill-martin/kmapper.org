import{d as r,a as St}from"./MapView-15a5ee40.js";import{_ as Et,u as Dt,d as Wt,f as jt,g as Z,h as b,i as It,o as Tt,j as Ct,F as Lt,q as Ft,s as Ot,a as R}from"./index-7756fce9.js";import{c as tt}from"./DetailsMapContainer-795ea6a2.js";const lt=I=>(Ft("data-v-b16704d3"),I=I(),Ot(),I),Rt=lt(()=>R("div",{id:"details-tooltip"},[R("div",{class:"tooltip-title"}),R("div",{class:"tooltip-citation"})],-1)),Ht=lt(()=>R("div",{id:"details-map"},null,-1)),et=0,w="#333447",at="#514efd",T="lightgrey",C="1.5px",A=1e3,Pt={__name:"DetailsMap",props:["sizes"],setup(I){const n=I,d=Dt(),l=Wt();jt(()=>{H(),L(),F(),j.value=r.select("#details-tooltip")});function H(){const t=r.select("#details-map");o.value=t.style("width").replace("px","")}const rt=St(()=>{st()},500);Z(()=>d.width,()=>{rt()});function st(){H(),L(),F()}function L(){r.select("#svg-details-chart").remove(),it(),ot()}function F(){ht(),mt()}const P=b(null),O=b(null),nt=It(()=>{const t=l.detailsMapGraph.children.length;let e=r.max(l.detailsMapGraph.children.map(s=>l.detailsMapGraph.type==="works"?s.data.children.length:s.children.length));e=e||2;const a=l.detailsMapGraph.type==="works"?k:v,c=l.detailsMapGraph.type==="works"?v:k;let i=null;return l.detailsMapGraph.type==="works"?i=t>=e?_+t*a:_+e*c:i=t>e?_+t*a:_+e*c,d.isMobile?_+a*l.detailsMapGraph.children.length+e*c:i}),o=b(null);function it(){P.value=r.select("#details-map").append("svg").attr("id","svg-details-chart").attr("viewBox",`0 0 ${o.value} ${nt.value}`),O.value=P.value.append("g").attr("id","details-chart-container").attr("transform",`translate(${et}, ${et})`)}function ot(){ct(),pt(),ut()}const B=b(null),m=b(null),M=b(null),_=n.sizes.worksBandwidth*5,k=n.sizes.worksBandwidth*3,v=n.sizes.worksBandwidth*1.5,g=n.sizes.worksBandwidth*.5,x=n.sizes.worksBandwidth*.5*2,D=r.easeElasticOut.amplitude(1).period(.4);function dt(){if(d.isMobile){let t=l.detailsMapGraph.children.length;const e=l.detailsMapGraph.type==="works"?k:v,a=l.detailsMapGraph.type==="works"?t*e:t*e+v*1.5;return`translate(0, ${_+a})`}else return`translate(${o.value*.5}, ${_})`}function ct(){B.value=O.value.append("g").attr("transform","translate(0, 0)")}function pt(){m.value=O.value.append("g").attr("transform",`translate(0, ${_})`)}function ut(){M.value=O.value.append("g").attr("transform",dt())}function ht(){l.detailsMapGraph.type==="works"?ft():l.detailsMapGraph.type==="sdgs"?wt():gt()}function ft(){const t=B.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${n.sizes.worksBandwidth*2})`);t.append("rect").attr("class","title-rect"),t.append("text").attr("class","title").text(l.detailsMapGraph.data.title),t.append("a").attr("xlink:href",l.detailsMapGraph.data.openAlexId).attr("target","_blank").append("rect").attr("class","title-rect-overlay").append("title").text(l.detailsMapGraph.data.title),t.selectAll(".title-rect,.title-rect-overlay").attr("width",o.value).attr("height",n.sizes.worksBandwidth),t.selectAll(".title-rect").attr("stroke",w).attr("fill",w),t.selectAll(".title-rect-overlay").attr("fill-opacity",0).attr("cursor","pointer"),t.selectAll(".title").attr("x",5).attr("y",n.sizes.worksBandwidth*.85).style("font-size",n.sizes.workTitle).attr("fill","white"),B.value.select(".title-group").transition().duration(A).ease(D).attr("transform","translate(0,0)"),B.value.append("g").attr("class","title-metadata").attr("transform",`translate(0, ${n.sizes.worksBandwidth*2})`).append("a").attr("xlink:href",l.detailsMapGraph.data.doi).attr("target","_blank").append("text").text(`${l.detailsMapGraph.data.year}${l.detailsMapGraph.data.source.name?`: ${l.detailsMapGraph.data.source.name}`:""} - ${l.detailsMapGraph.data.doi}`).style("font-size",`${n.sizes.field*.85}px`).attr("fill",w)}function wt(){const a=B.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${n.sizes.worksBandwidth*4})`).append("a").attr("xlink:href",l.detailsMapGraph.data.url).attr("target","_blank").append("g").attr("transform",`translate(${n.sizes.worksBandwidth}, ${n.sizes.worksBandwidth})`);a.append("circle").attr("r",g).attr("stroke",w).attr("fill",w),a.append("text").text(`SDG ${l.detailsMapGraph.data.id}`).attr("x",x).attr("y",0).style("font-size",`${n.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor","start"),a.append("rect").attr("x",x).attr("y",0).attr("fill",l.detailsMapGraph.data.color).attr("opacity",.4).attr("width",l.detailsMapGraph.data.labelBbox.width).attr("height",l.detailsMapGraph.data.labelBbox.height),a.append("text").text(l.detailsMapGraph.data.name).attr("x",x).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",n.sizes.sdgLabel).attr("text-anchor","start"),B.value.select(".title-group").transition().duration(A).ease(D).attr("transform","translate(0,0)")}function gt(){const a=B.value.append("g").attr("class","title-group").attr("transform",`translate(0,-${n.sizes.worksBandwidth*4})`).append("a").attr("xlink:href",l.detailsMapGraph.data.url).attr("target","_blank").append("g").attr("transform",`translate(${n.sizes.worksBandwidth}, ${n.sizes.worksBandwidth})`);a.append("circle").attr("r",g).attr("stroke",w).attr("fill",w),a.append("text").text(l.detailsMapGraph.data.name).attr("x",x).attr("y",0).style("font-size",`${n.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","start"),B.value.select(".title-group").transition().duration(A).ease(D).attr("transform","translate(0,0)")}function mt(){l.detailsMapGraph.type==="works"?kt(l.detailsMapGraph.children,xt,q):$t(l.detailsMapGraph.children,zt,K)}function kt(t,e,a){m.value.selectAll(".first-group-line").data(t).join(c=>c.append("line").attr("class",(i,s)=>["first-group-line",`element-${s}`].join(" ")).attr("stroke",i=>i.data.children.length?T:null).attr("stroke-width",C).attr("x1",x*1.5).attr("y1",(i,s)=>s*k).attr("x2",()=>d.isMobile?o.value*.9:o.value*.4).attr("y2",(i,s)=>s*k)),e(t,yt,vt),a(Q,J)}function xt(t,e,a){m.value.selectAll(".first-group-element").data(t).join(c=>c.append("g").attr("class",(i,s)=>["first-group-element",`element-${s}`].join(" ")).attr("transform",`translate(0, -${k*2})`).each(function(i,s){if(i.type==="sdg"){const p=l.homeMapGraph.sdgs.find(z=>z.id===i.data.id),f=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("cursor","pointer");f.append("circle").attr("data-id",z=>z.id).attr("cx",g*1.1).attr("cy",0).attr("r",g).attr("stroke",w).attr("fill",w),f.append("text").attr("class","sdg-group-id").attr("x",x*1.5).attr("y",0).text(z=>`SDG ${z.data.id}`).style("font-size",`${n.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor","start"),f.append("rect").attr("x",x*1.5).attr("y",0).attr("fill",z=>z.data.color).attr("opacity",.4).attr("width",p.labelBbox.width).attr("height",p.labelBbox.height),f.append("text").text(z=>z.data.name).attr("x",x*1.5).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",n.sizes.sdgLabel).attr("text-anchor","start")}else{const p=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("cursor","pointer");p.append("circle").attr("data-id",f=>f.id).attr("cx",g*1.1).attr("cy",0).attr("r",g).attr("stroke",w).attr("fill",w),p.append("text").attr("class","field-group-name").attr("x",x*1.5).attr("y",0).text(f=>f.data.name).style("font-size",`${n.sizes.field}px`).attr("dominant-baseline",()=>i.data.children.length?"text-after-edge":"middle").attr("text-anchor","start")}const u=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("transform",`translate(${d.isMobile?o.value*.9:o.value*.4},0)`).attr("cursor","pointer");i.data.children.length&&(u.append("circle").attr("r",g*1.4).attr("stroke",w).attr("fill",w),u.append("text").text(p=>p.data.children.length).attr("fill","white").style("font-size",`${n.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","middle"))})),m.value.selectAll(".first-group-element").transition().duration(A).ease(D).attr("transform",(c,i)=>`translate(0, ${i*k})`),e(),a()}function h(t){return t==="mouseover"?at:w}function S(t){return t==="mouseover"?at:T}function E(t){return t==="mouseover"?"2.5px":C}function W(t){return t==="mouseover"?"bold":"regular"}function yt(){m.value.selectAll(".group-element").on("mouseover mouseout",function(t){const e=r.select(this).attr("data-index");l.detailsMapGraph.children[e].data.children.length&&r.selectAll(`line.element-${e}`).attr("stroke",S(t.type)).attr("stroke-width",E(t.type)),r.selectAll(`.connection-line-${e}`).attr("stroke",S(t.type)).attr("stroke-width",E(t.type)),e===y.value&&r.selectAll(".shown-work-rect").attr("stroke",h(t.type)).attr("fill",h(t.type)),r.selectAll(`.element-${e} circle`).attr("stroke",h(t.type)).attr("fill",h(t.type)),r.selectAll(`.element-${e} .sdg-group-id`).attr("fill",h(t.type)).attr("font-weight",W(t.type)),r.selectAll(`.element-${e} .field-group-name`).attr("fill",h(t.type)).attr("font-weight",W(t.type))})}const y=b(null),$=b([]),G=b([]);Z(()=>y.value,()=>{l.detailsMapGraph.type==="works"?q(Q,J):K(U,Y)});function vt(){m.value.selectAll(".group-element").on("click",function(){const t=r.select(this).attr("data-index");if(l.detailsMapGraph.children[t].data.children.length?y.value=t:y.value=null,l.detailsMapGraph.children[t].data.children.length){const e=l.detailsMapGraph.children[t].data.children;$.value=e}else $.value=[]})}function Mt(){m.value.selectAll(".group-element").on("click",function(){const t=r.select(this).attr("data-index");if(l.detailsMapGraph.children[t].children.length?y.value=t:y.value=null,l.detailsMapGraph.children[t].children.length){const e=l.detailsMapGraph.children[t].children;G.value=e}else G.value=[]})}function q(t,e){const a=M.value.selectAll(".shown-work").data($.value,function(u){return u}),c=a.enter().append("g").attr("class","shown-work").attr("transform",`translate(0, -${v*2})`);c.append("rect").attr("class","shown-work-rect").attr("data-id",(u,p)=>p),c.append("text").attr("class","shown-work-title").text(u=>u.title),c.append("rect").attr("class","shown-work-overlay").data($.value,function(u,p){return p});const i=c.merge(a);i.select(".shown-work-title").text(u=>u.title),i.select(".shown-work-overlay title").text(u=>u.title),a.exit().remove(),M.value.selectAll(".shown-work-rect,.shown-work-overlay").attr("width",()=>d.isMobile?o.value*.9:o.value*.5).attr("height",n.sizes.worksBandwidth),M.value.selectAll(".shown-work-rect").attr("stroke",w).attr("fill",w),M.value.selectAll(".shown-work-overlay").attr("class","shown-work-overlay").attr("data-id",(u,p)=>p).attr("fill-opacity",0).attr("cursor","pointer"),M.value.selectAll(".shown-work-title").attr("x",5).attr("y",n.sizes.worksBandwidth*.85).style("font-size",n.sizes.workTitle).attr("fill","#f7f7f7"),M.value.selectAll(".shown-work").transition().duration(A).ease(D).attr("transform",(u,p)=>`translate(0, ${v*p})`),t(),e(bt)}function Gt(t){const e=d.isMobile?o.value*.9+g*1.5:o.value*.4+g*1.5,a=t*k,c=d.isMobile?o.value*.96:o.value*.4+g*4,i=d.isMobile?o.value*.96:o.value*.4+g*8,s=d.isMobile?l.detailsMapGraph.children.length*k+($.value.length-1)*.5*v+n.sizes.worksBandwidth*.5:n.sizes.worksBandwidth*.5,u=d.isMobile?o.value*.92:o.value*.495,p=d.isMobile?l.detailsMapGraph.children.length*k+($.value.length-1)*.5*v+n.sizes.worksBandwidth*.5:($.value.length-1)*.5*v+n.sizes.worksBandwidth*.5;return[[{x:e,y:a},{x:c,y:a},{x:i,y:s},{x:u,y:p}]]}function N(t){return r.line().x(a=>a.x).y(a=>a.y).curve(r.curveCatmullRom.alpha(.5))(t)}function Q(){const t=y.value?Gt(y.value):[];r.selectAll(".connection-line").remove(),m.value.selectAll(".connection-line").data(t).join(e=>e.append("path").attr("class",["connection-line",`connection-line-${y.value}`].join(" ")).attr("d",a=>N(a)).attr("stroke","white").attr("fill","none").attr("stroke-width",C),e=>e,e=>e),m.value.selectAll(".connection-line").transition().duration(A*.3).attr("stroke",T)}const j=b(null);function V(t){j.value.select(".tooltip-title").text(t.title),j.value.select(".tooltip-citation").text(`${t.year}${t.source.name?`: ${t.source.name}`:""}`)}function X(t,e){j.value.style("visibility",t==="mouseover"?"visible":"hidden"),j.value.style("width",`${o.value}px`).style("left",`${(d.width-d.modalWidth)/2}px`).style("top",`${e.top-85}px`)}function J(t){M.value.selectAll(".shown-work-overlay").on("mouseover mouseout",function(e,a){const c=y.value,i=r.select(this).attr("data-id");r.select(`.shown-work-rect[data-id='${i}']`).attr("stroke",h(e.type)).attr("fill",h(e.type)),r.selectAll(`line.element-${c}`).attr("stroke",S(e.type)).attr("stroke-width",E(e.type)),r.selectAll(`.connection-line-${c}`).attr("stroke",S(e.type)).attr("stroke-width",E(e.type)),r.selectAll(`.element-${c} circle`).attr("stroke",h(e.type)).attr("fill",h(e.type)),r.selectAll(`.element-${c} .sdg-group-id`).attr("fill",h(e.type)).attr("font-weight",W(e.type)),r.selectAll(`.element-${c} .field-group-name`).attr("fill",h(e.type)).attr("font-weight",W(e.type)),V(a),X(e.type,this.getBoundingClientRect())}),t()}function bt(){M.value.selectAll(".shown-work-overlay").on("click",async function(){j.value.style("visibility","hidden");const t=r.select(this).attr("data-id"),e={type:"works",root:$.value[t],sizes:n.sizes},a=await tt(e);l.setDetailsMapGraph(a),$.value=[],y.value=null,L(),F()})}function $t(t,e,a){e(t,At,Mt),m.value.selectAll(".first-group-line").data(t).join(c=>c.append("line").attr("class",(i,s)=>["first-group-line",`element-${s}`].join(" ")).attr("stroke",i=>i.children.length?T:null).attr("stroke-width",C).attr("x1",d.isMobile?o.value*.75:o.value*.45).attr("y1",(i,s)=>s*v+n.sizes.worksBandwidth*.5).attr("x2",d.isMobile?o.value*.9-g*1.5*2:o.value*.5-g*1.5).attr("y2",(i,s)=>s*v+n.sizes.worksBandwidth*.5)),a(U,Y)}function zt(t,e,a){m.value.selectAll(".first-group-element").data(t).join(c=>c.append("g").attr("class",(i,s)=>["first-group-element",`element-${s}`].join(" ")).attr("transform",`translate(0, -${v*2})`).each(function(i,s){const u=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s);u.append("rect").attr("class","first-group-work-rect").attr("data-id",s),u.append("text").attr("class","first-group-work-title").attr("data-id",f=>f.id).text(f=>f.title),u.append("rect").attr("class","first-group-work-overlay");const p=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("transform",`translate(${d.isMobile?o.value*.9-g*1.5:o.value*.5},${n.sizes.worksBandwidth*.5})`).attr("cursor","pointer");i.children.length&&(p.append("circle").attr("class","first-group-work-circle").attr("r",g*1.4).attr("stroke",w).attr("fill",w),p.append("text").text(f=>f.children.length).attr("fill","#f7f7f7").style("font-size",`${n.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor","middle"))})),m.value.selectAll(".first-group-work-rect,.first-group-work-overlay").attr("width",()=>d.isMobile?o.value*.75:o.value*.45).attr("height",n.sizes.worksBandwidth),m.value.selectAll(".first-group-work-rect").attr("stroke",w).attr("fill",w),m.value.selectAll(".first-group-work-overlay").attr("fill-opacity",0).attr("cursor","pointer"),m.value.selectAll(".first-group-work-title").attr("x",5).attr("y",n.sizes.worksBandwidth*.85).style("font-size",n.sizes.workTitle).attr("fill","white"),m.value.selectAll(".first-group-element").transition().duration(A).ease(D).attr("transform",(c,i)=>`translate(0, ${v*i})`),e(),a()}function At(){m.value.selectAll(".group-element").on("mouseover mouseout",function(t,e){const a=r.select(this).attr("data-index");l.detailsMapGraph.children[a].children.length&&r.selectAll(`line.element-${a}`).attr("stroke",S(t.type)).attr("stroke-width",E(t.type)),r.selectAll(`.connection-line-${a}`).attr("stroke",S(t.type)).attr("stroke-width",E(t.type)),a===y.value&&(r.selectAll(".shown-element-circle").attr("stroke",h(t.type)).attr("fill",h(t.type)),r.selectAll(".shown-sdg-group-id, .shown-field-group-name").attr("fill",h(t.type)).attr("font-weight",W(t.type))),r.selectAll(`.element-${a} .first-group-work-circle`).attr("stroke",h(t.type)).attr("fill",h(t.type)),r.selectAll(`.element-${a} .first-group-work-rect`).attr("stroke",h(t.type)).attr("fill",h(t.type)),V(e),X(t.type,this.getBoundingClientRect())})}function K(t,e){r.selectAll(".shown-element").remove(),M.value.selectAll(".shown-element").data(G.value,function(i){return i}).enter().append("g").attr("class","shown-element").attr("data-id",(i,s)=>s).attr("transform",`translate(${d.isMobile?o.value*.85:o.value*.15}, -${k*2})`).each(function(i,s){if(i.type==="sdg"){const u=l.homeMapGraph.sdgs.find(f=>f.id===i.data.id),p=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("cursor","pointer");p.append("circle").attr("class","shown-element-circle").attr("data-id",f=>f.id).attr("r",g).attr("stroke",w).attr("fill",w),p.append("text").attr("class","shown-sdg-group-id").text(f=>`SDG ${f.data.id}`).attr("x",()=>d.isMobile?-x:x).attr("y",0).style("font-size",`${n.sizes.sdgId}px`).attr("dominant-baseline","text-after-edge").attr("text-anchor",()=>d.isMobile?"end":"start"),p.append("rect").attr("x",d.isMobile?-(u.labelBbox.width+x):x).attr("y",0).attr("fill",f=>f.data.color).attr("opacity",.4).attr("width",u.labelBbox.width).attr("height",u.labelBbox.height),p.append("text").text(f=>f.data.name).attr("x",()=>d.isMobile?-x:x).attr("y",0).attr("dominant-baseline","text-before-edge").style("font-size",n.sizes.sdgLabel).attr("text-anchor",()=>d.isMobile?"end":"start")}else{const u=r.select(this).append("g").attr("class",["group-element",`element-${s}`].join(" ")).attr("data-index",s).attr("cursor","pointer");u.append("circle").attr("class","shown-element-circle").attr("data-id",p=>p.id).attr("r",g).attr("stroke",w).attr("fill",w),u.append("text").attr("class","shown-field-group-name").text(p=>p.data.name).attr("x",()=>d.isMobile?-x:x).attr("y",0).style("font-size",`${n.sizes.field}px`).attr("dominant-baseline","middle").attr("text-anchor",()=>d.isMobile?"end":"start")}}),M.value.selectAll(".shown-element").transition().duration(A).ease(D).attr("transform",(i,s)=>`translate(${d.isMobile?o.value*.9-g*1.5:o.value*.15}, ${k*s})`),t(),e(_t)}function Bt(t){const e=d.isMobile?o.value*.9:g*1.5,a=t*v+n.sizes.worksBandwidth*.5,c=d.isMobile?o.value*.95:o.value*.1,i=d.isMobile?o.value*.95:o.value*.1,s=d.isMobile?l.detailsMapGraph.children.length*v+G.value.length*.5*k+k*.25:(G.value.length-1)*.5*k,u=d.isMobile?o.value*.9:o.value*.14,p=d.isMobile?l.detailsMapGraph.children.length*v+G.value.length*.5*k+k*.25:(G.value.length-1)*.5*k;return[[{x:e,y:a},{x:c,y:a},{x:i,y:s},{x:u,y:p}]]}function U(){const t=y.value?Bt(y.value):[],e=d.isMobile?m.value:M.value;r.selectAll(".connection-line").remove(),e.selectAll(".connection-line").data(t).join(a=>a.append("path").attr("class",["connection-line",`connection-line-${y.value}`].join(" ")).attr("d",c=>N(c)).attr("stroke","white").attr("fill","none").attr("stroke-width",C),a=>a,a=>a),e.selectAll(".connection-line").transition().duration(A*.3).attr("stroke",T)}function Y(t){M.value.selectAll(".shown-element").on("mouseover mouseout",function(e){const a=y.value;r.select(this).select(".shown-element-circle").attr("stroke",h(e.type)).attr("fill",h(e.type)),r.select(this).select(".shown-sdg-group-id, .shown-field-group-name").attr("fill",h(e.type)).attr("font-weight",W(e.type)),r.selectAll(`line.element-${a}`).attr("stroke",S(e.type)).attr("stroke-width",E(e.type)),r.selectAll(`.connection-line-${a}`).attr("stroke",S(e.type)).attr("stroke-width",E(e.type)),r.selectAll(`.element-${a} .first-group-work-circle`).attr("stroke",h(e.type)).attr("fill",h(e.type)),r.selectAll(`.element-${a} .first-group-work-rect`).attr("stroke",h(e.type)).attr("fill",h(e.type))}),t()}function _t(){M.value.selectAll(".shown-element").on("click",async function(){const t=r.select(this).attr("data-id");let e=G.value[t].data;if(G.value[t].type==="sdg"){const i=l.homeMapGraph.sdgs.find(s=>s.id===e.id);e.labelBbox=i.labelBbox}const a={type:`${G.value[t].type}s`,root:e,sizes:n.sizes},c=await tt(a);l.setDetailsMapGraph(c),G.value=[],y.value=null,L(),F()})}return(t,e)=>(Tt(),Ct(Lt,null,[Rt,Ht],64))}},Vt=Et(Pt,[["__scopeId","data-v-b16704d3"]]);export{Vt as default};
